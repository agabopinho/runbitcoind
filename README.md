# Bitcoin Core Node with Tor

This project sets up a Bitcoin Core full node using the official [`kylemanna/bitcoind`](https://hub.docker.com/r/kylemanna/bitcoind) Docker image, with configurations for both fast initial sync and privacy-focused operation through Tor.

## Overview

This project provides two distinct Docker Compose configurations using the [`kylemanna/bitcoind`](https://github.com/kylemanna/docker-bitcoind) image:

**Sync Mode (`docker-compose-sync.yml`):**
- Bitcoin Core node optimized for fast initial blockchain download
- Direct clearnet connections for maximum speed
- 4GB cache and 200 connections for optimal performance

**Tor Mode (`docker-compose-tor.yml`):**
- Bitcoin Core node + Tor proxy for maximum privacy
- All traffic routed through Tor network
- Onion-only connections for enhanced anonymity

## Prerequisites

- Docker and Docker Compose installed on your system
- Sufficient disk space for the Bitcoin blockchain (>500GB recommended)
- Open ports on your firewall/router (if needed)

## Docker Images Used

- **Bitcoin Core**: [`kylemanna/bitcoind:latest`](https://hub.docker.com/r/kylemanna/bitcoind) - Official Docker image for Bitcoin Core
- **Tor Proxy**: [`dperson/torproxy:latest`](https://hub.docker.com/r/dperson/torproxy) - Tor SOCKS5 proxy for privacy mode

## Setup

This project includes two configurations:

### 1. Initial Blockchain Sync (Fast Download)
Use `docker-compose-sync.yml` for the initial blockchain download:

1. Clone this repository
2. Make sure you have the directory `D:/bitcoind` created (or modify the volume path)
3. Start the fast sync configuration:
   ```bash
   docker-compose -f docker-compose-sync.yml up -d
   ```
4. Monitor the sync progress:
   ```bash
   docker-compose -f docker-compose-sync.yml logs -f
   ```

### 2. Tor Configuration (After Sync)
Once the blockchain is fully synced, switch to the Tor configuration for privacy:

1. Stop the sync configuration:
   ```bash
   docker-compose -f docker-compose-sync.yml down
   ```
2. Start the Tor configuration:
   ```bash
   docker-compose -f docker-compose-tor.yml up -d
   ```
3. Check the logs:
   ```bash
   docker-compose -f docker-compose-tor.yml logs -f
   ```

## Configuration

Both configurations use the [`kylemanna/bitcoind`](https://hub.docker.com/r/kylemanna/bitcoind) image with the `btc_oneshot` command for automatic setup.

### Fast Sync Configuration (`docker-compose-sync.yml`)
Optimized for initial blockchain download using fixed `kylemanna/bitcoind` version:
- **Image**: `kylemanna/bitcoind@sha256:6f1240b4ac20...` (Bitcoin Core v28.1.0)
- **Cache**: 4GB database cache (`-dbcache=4096`) - 10x faster than default
- **Connections**: Up to 200 peer connections (`-maxconnections=200`)
- **Upload Limit**: 10GB bandwidth control (`-maxuploadtarget=10000`)
- **Network**: Direct clearnet connections (no Tor)
- **RPC**: Automatic secure credentials generation via `btc_oneshot`
- **Performance**: ~10x faster sync compared to default settings

### Tor Configuration (`docker-compose-tor.yml`)
Optimized for privacy after sync using fixed versions:
- **Images**: 
  - `kylemanna/bitcoind@sha256:6f1240b4ac20...` (Bitcoin Core v28.1.0)
  - `dperson/torproxy:latest` for Tor SOCKS5 proxy
- **Privacy**: All traffic routed through Tor (`-proxy=tor:9050`)
- **Onion-Only**: Connects exclusively to .onion addresses (`-onlynet=onion`)
- **DNS Security**: DNS seeds disabled (`-dnsseed=0`)
- **Pre-configured Nodes**: Includes reliable .onion Bitcoin nodes
- **Cache**: 1GB cache (`-dbcache=1024`) - balanced for Tor usage

## Accessing the Bitcoin node

### RPC Access
- **Port**: 8333 (P2P) and 8332 (RPC) mapped to host
- **Credentials**: Auto-generated by [`kylemanna/bitcoind`](https://hub.docker.com/r/kylemanna/bitcoind) `btc_oneshot` script
  - Username: `bitcoinrpc` 
  - Password: Randomly generated on first start
- **Configuration**: Check `D:/bitcoind/bitcoin.conf` for current credentials

### Network Access
- **Sync Mode**: Direct internet connection for fast download
- **Tor Mode**: SOCKS5 proxy available on port 9050

### Checking Status
```bash
# Check sync progress
docker-compose -f docker-compose-sync.yml exec bitcoind bitcoin-cli getblockchaininfo

# Check network connections  
docker-compose -f docker-compose-sync.yml exec bitcoind bitcoin-cli getnetworkinfo

# View RPC credentials
docker-compose -f docker-compose-sync.yml exec bitcoind cat ~/.bitcoin/bitcoin.conf
```

## Data Storage

The Bitcoin blockchain data is stored in `D:/bitcoind` on your host system.

## Network

Both containers operate on an isolated Docker bridge network called `bitcoin-net`.

## Security Considerations

### Sync Mode Security
- **Performance vs Privacy**: Fast sync uses clearnet connections
- **Temporary**: Switch to Tor mode after initial blockchain download
- **Network Exposure**: Bitcoin node activity visible to ISP during sync

### Tor Mode Security  
- **Maximum Privacy**: All Bitcoin traffic routed through Tor
- **Onion-Only**: No clearnet connections (`-onlynet=onion`)
- **DNS Protection**: DNS seeds disabled to prevent leaks
- **Credential Security**: Auto-generated RPC passwords
- **Network Isolation**: Bitcoin and Tor on isolated Docker network

### Best Practices
- Use sync mode only for initial download
- Switch to Tor mode for regular operation
- Monitor disk space (blockchain >500GB)
- Keep Docker images updated
- Backup wallet files if using wallet features

## Maintenance

- Keep both Docker images updated regularly for security patches
- Monitor disk space usage as the blockchain grows over time

## Docker Image Versions

This project uses **fixed versions** for reproducible and secure deployments:

### Bitcoin Core Image
- **Image**: `kylemanna/bitcoind@sha256:6f1240b4ac20...`  
- **Bitcoin Core Version**: v28.1.0
- **Image Date**: January 2021 (last build)
- **Repository**: [kylemanna/docker-bitcoind](https://github.com/kylemanna/docker-bitcoind)

### Tor Proxy Image  
- **Image**: `dperson/torproxy:latest`
- **Repository**: [dperson/torproxy](https://hub.docker.com/r/dperson/torproxy)

### Why Fixed Versions?
- **Reproducible builds**: Same image across all environments
- **Security**: Prevents unexpected updates with vulnerabilities  
- **Stability**: Avoids breaking changes from automatic updates
- **Audit trail**: Clear record of exactly which version is running

### Updating Images
To update to newer versions:

1. **Check for updates**:
   ```bash
   docker pull kylemanna/bitcoind:latest
   docker run --rm kylemanna/bitcoind:latest bitcoind --version
   ```

2. **Get new SHA256**:
   ```bash
   docker inspect kylemanna/bitcoind:latest --format='{{.Id}}'
   ```

3. **Update docker-compose files** with new SHA256
4. **Test thoroughly** before deploying to production

## Credits and References

- **Bitcoin Core Docker Image**: [`kylemanna/bitcoind`](https://hub.docker.com/r/kylemanna/bitcoind) - Official Docker implementation
- **GitHub Repository**: [`kylemanna/docker-bitcoind`](https://github.com/kylemanna/docker-bitcoind) - Source code and documentation
- **Tor Proxy Image**: [`dperson/torproxy`](https://hub.docker.com/r/dperson/torproxy) - Tor SOCKS5 proxy container
- **Bitcoin Core**: [Bitcoin Core Official Website](https://bitcoincore.org/) - The reference implementation

This setup leverages the excellent work from the Docker community, specifically the `kylemanna/bitcoind` image which provides a secure and well-maintained Bitcoin Core implementation with automatic configuration via the `btc_oneshot` script.